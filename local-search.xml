<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>004-ModBus报文解析实战</title>
    <link href="/2023/10/08/004-ModBus%E6%8A%A5%E6%96%87%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/"/>
    <url>/2023/10/08/004-ModBus%E6%8A%A5%E6%96%87%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h1 id="ModBus-报文解析实战"><a href="#ModBus-报文解析实战" class="headerlink" title="ModBus 报文解析实战"></a>ModBus 报文解析实战</h1><p>事情是这样的，项目需要一个串口采集1032协议电压的功能。在实现中还是遇到不少问题，由于是第一次使用，遂做下一些记录。</p><img src="/2023/10/08/004-ModBus%E6%8A%A5%E6%96%87%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/photo_1.png" class="" title="ModBus模拟量Hex"><img src="/2023/10/08/004-ModBus%E6%8A%A5%E6%96%87%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/photo_2.png" class="" title="ModBus模拟量Float"><h2 id="报文内容"><a href="#报文内容" class="headerlink" title="报文内容"></a>报文内容</h2><p>使用串口发送 ModBus 报文时，需要解析收到的报文</p><blockquote><p>01 03 04 00 00 41 40 CB 93</p></blockquote><p>这是请求报文：</p><ul><li>01：设备地址，表示要访问的 Modbus 设备的地址为1。</li><li>03：功能码，表示要读取保持寄存器。</li><li>00 00：起始地址，表示要读取的保持寄存器的起始地址为0。</li><li>00 02：寄存器数量，表示要读取的保持寄存器数量为2。</li><li>C4 0B：CRC 校验码，用于验证报文的正确性。</li></ul><p>返回报文：</p><ul><li>01：设备地址，表示返回的报文是来自地址为1的 Modbus 设备。</li><li>03：功能码，表示返回的报文是读取保持寄存器的响应报文。</li><li>04：字节数，表示返回的数据字节数为4。</li><li>00 00：寄存器值，表示起始地址为0的第一个保持寄存器的值。</li><li>41 40：寄存器值，表示起始地址为1的第二个保持寄存器的值。</li><li>CB 93：CRC校验码，用于验证报文的正确性。</li></ul><h2 id="解析返回报文"><a href="#解析返回报文" class="headerlink" title="解析返回报文"></a>解析返回报文</h2><p>由于我只需要采集单路 ModBus 所以我的请求报文是固定的。因此我的返回报文的头部内容也是固定的。</p><p>所以我们需要解析的数据就是</p><blockquote><p>00 00 41 40</p><p>注意：这是IEEE 754浮点数</p></blockquote><p>这就是我们需要的电压数据。其实很简单，只需要做一个十六进制转float就可以。</p><img src="/2023/10/08/004-ModBus%E6%8A%A5%E6%96%87%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/photo_3.jpg" class="" title="Hex转Float"><p>细心的朋友可能发现了，我是使用41400000转换的，这是为什么呢？</p><h2 id="C-语言代码实现"><a href="#C-语言代码实现" class="headerlink" title="C 语言代码实现"></a>C 语言代码实现</h2><h3 id="使用共用体进行类型转换"><a href="#使用共用体进行类型转换" class="headerlink" title="使用共用体进行类型转换"></a>使用共用体进行类型转换</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">uint8_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> <span class="hljs-type">uint16_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-type">uint32_t</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> &#123;<br>  <span class="hljs-type">uint8_t</span> rsp[] = &#123;<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x40</span>&#125;;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>首先要明确的是，直接使用强制类型转换是不行的。直接看代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">uint8_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> <span class="hljs-type">uint16_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-type">uint32_t</span>;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br>  <span class="hljs-type">uint32_t</span> u32;<br>  <span class="hljs-type">float</span> f;<br>&#125; <span class="hljs-type">float_union_t</span>;<br><br><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">float</span> <span class="hljs-title function_">utils_get_float_at</span><span class="hljs-params">(<span class="hljs-type">void</span> *data, <span class="hljs-type">int</span> pos)</span> &#123;<br>  <span class="hljs-type">uint8_t</span> __attribute__((aligned(<span class="hljs-number">4</span>))) tmp[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>  <span class="hljs-built_in">memcpy</span>(tmp, (<span class="hljs-type">uint8_t</span> *)data, <span class="hljs-number">4</span>);<br>  <span class="hljs-type">uint32_t</span> lw = *((<span class="hljs-type">uint32_t</span> *)(((<span class="hljs-type">uint8_t</span> *)(tmp)) + pos));<br>  <span class="hljs-type">float_union_t</span> fu = &#123;.u32 = lw&#125;;<br>  <span class="hljs-keyword">return</span> fu.f;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> &#123;<br>  <span class="hljs-type">uint8_t</span> rsp[] = &#123;<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x40</span>&#125;;<br>  <span class="hljs-type">float</span> value = utils_get_float_at(rsp, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;value = %f\n&quot;</span>, value);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>输出结果如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">pureos@pureos:~$ gcc 1.c -o 1<br>pureos@pureos:~$ ./1<br>value = 3.015625<br></code></pre></td></tr></table></figure><p>可以看到我们按照正常的字节序转换出来的浮点数是错误的，将这个值转换为十六进制为：</p><blockquote><p>40 41 00 00</p></blockquote><img src="/2023/10/08/004-ModBus%E6%8A%A5%E6%96%87%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/photo_4.png" class="" title="Float转Hex"><h3 id="寻找正确的12-000000"><a href="#寻找正确的12-000000" class="headerlink" title="寻找正确的12.000000"></a>寻找正确的12.000000</h3><p>所以正确的<code>12.000000</code> 应该是多少呢？</p><p>使用以下函数查看一下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">uint8_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> <span class="hljs-type">uint16_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-type">uint32_t</span>;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br>  <span class="hljs-type">uint32_t</span> u32;<br>  <span class="hljs-type">float</span> f;<br>&#125; <span class="hljs-type">float_union_t</span>;<br><br><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">float</span> <span class="hljs-title function_">utils_get_float_at</span><span class="hljs-params">(<span class="hljs-type">void</span> *data, <span class="hljs-type">int</span> pos)</span> &#123;<br>  <span class="hljs-type">uint8_t</span> __attribute__((aligned(<span class="hljs-number">4</span>))) tmp[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>  <span class="hljs-built_in">memcpy</span>(tmp, (<span class="hljs-type">uint8_t</span> *)data, <span class="hljs-number">4</span>);<br>  <span class="hljs-type">uint32_t</span> lw = *((<span class="hljs-type">uint32_t</span> *)(((<span class="hljs-type">uint8_t</span> *)(tmp)) + pos));<br>  <span class="hljs-type">float_union_t</span> fu = &#123;.u32 = lw&#125;;<br>  <span class="hljs-keyword">return</span> fu.f;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title function_">utils_set_float_at</span><span class="hljs-params">(<span class="hljs-type">void</span> *data, <span class="hljs-type">int</span> pos, <span class="hljs-type">float</span> value)</span> &#123;<br>  *((<span class="hljs-type">uint32_t</span> *)((<span class="hljs-type">uint8_t</span> *)(data) + pos)) = *(<span class="hljs-type">uint32_t</span> *)(&amp;value);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> &#123;<br>  <span class="hljs-type">uint8_t</span> rsp[] = &#123;<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x40</span>&#125;;<br>  <span class="hljs-type">float</span> value = utils_get_float_at(rsp, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;value = %f\n&quot;</span>, value);<br><br>  <span class="hljs-type">uint8_t</span> float_to_hex_buf[<span class="hljs-number">4</span>];<br>  <span class="hljs-type">float</span> float_num = <span class="hljs-number">12.000000</span>;<br>  bzero(float_to_hex_buf, <span class="hljs-keyword">sizeof</span>(float_to_hex_buf));<br>  utils_set_float_at(float_to_hex_buf, <span class="hljs-number">0</span>, float_num);<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;float %f to hex = &quot;</span>, float_num);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.02hx &quot;</span>, float_to_hex_buf[i]);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码输出结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">pureos@pureos:~$ gcc 1.c -o 1<br>pureos@pureos:~$ ./1<br>value = 3.015625<br>float 12.000000 to hex = 00 00 40 41 <br></code></pre></td></tr></table></figure><p>现在已经非常清晰了，在我当前的环境中，需要将每位寄存器上的数据位互换位置。也就是两两之间互换。</p><p>原始数据：00 00 41 40</p><p>正确数据：00 00 40 41</p><p>然后将uint8的数据转为uint16，这个时候就可以获取正确的数据了</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">uint8_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> <span class="hljs-type">uint16_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-type">uint32_t</span>;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br>  <span class="hljs-type">uint32_t</span> u32;<br>  <span class="hljs-type">float</span> f;<br>&#125; <span class="hljs-type">float_union_t</span>;<br><br><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">float</span> <span class="hljs-title function_">utils_get_float_at</span><span class="hljs-params">(<span class="hljs-type">void</span> *data, <span class="hljs-type">int</span> pos)</span> &#123;<br>  <span class="hljs-type">uint8_t</span> __attribute__((aligned(<span class="hljs-number">4</span>))) tmp[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>  <span class="hljs-built_in">memcpy</span>(tmp, (<span class="hljs-type">uint8_t</span> *)data, <span class="hljs-number">4</span>);<br>  <span class="hljs-type">uint32_t</span> lw = *((<span class="hljs-type">uint32_t</span> *)(((<span class="hljs-type">uint8_t</span> *)(tmp)) + pos));<br>  <span class="hljs-type">float_union_t</span> fu = &#123;.u32 = lw&#125;;<br>  <span class="hljs-keyword">return</span> fu.f;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title function_">utils_set_float_at</span><span class="hljs-params">(<span class="hljs-type">void</span> *data, <span class="hljs-type">int</span> pos, <span class="hljs-type">float</span> value)</span> &#123;<br>  *((<span class="hljs-type">uint32_t</span> *)((<span class="hljs-type">uint8_t</span> *)(data) + pos)) = *(<span class="hljs-type">uint32_t</span> *)(&amp;value);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> &#123;<br>  <span class="hljs-type">uint8_t</span> rsp[] = &#123;<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x40</span>&#125;;<br>  <span class="hljs-type">float</span> value = utils_get_float_at(rsp, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;value = %f\n&quot;</span>, value);<br><br>  <span class="hljs-type">uint8_t</span> float_to_hex_buf[<span class="hljs-number">4</span>];<br>  <span class="hljs-type">float</span> float_num = <span class="hljs-number">12.000000</span>;<br>  bzero(float_to_hex_buf, <span class="hljs-keyword">sizeof</span>(float_to_hex_buf));<br>  utils_set_float_at(float_to_hex_buf, <span class="hljs-number">0</span>, float_num);<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;float %f to hex = &quot;</span>, float_num);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.02hx &quot;</span>, float_to_hex_buf[i]);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br>  <span class="hljs-type">uint16_t</span> dest[<span class="hljs-number">4</span>];<br>  bzero(dest, <span class="hljs-keyword">sizeof</span>(dest));<br>  <span class="hljs-type">int</span> rc = <span class="hljs-number">2</span>;<br>  <span class="hljs-type">int</span> offset = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; rc; i++) &#123;<br>    <span class="hljs-comment">/* shift reg hi_byte to temp OR with lo_byte */</span><br>    dest[i] = (rsp[(i &lt;&lt; <span class="hljs-number">1</span>)] &lt;&lt; <span class="hljs-number">8</span>) | rsp[offset + (i &lt;&lt; <span class="hljs-number">1</span>)];<br>  &#125;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.04hx &quot;</span>, dest[i]);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br>  value = utils_get_float_at(dest, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;value = %f\n&quot;</span>, value);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>输出为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">pureos@pureos:~$ gcc 1.c -o 1<br>pureos@pureos:~$ ./1<br>value = 3.015625<br>float 12.000000 to hex = 00 00 40 41 <br>0000 4140 <br>value = 12.000000<br></code></pre></td></tr></table></figure><p>可以看到，我们已经正确解析出了电压值。</p><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">uint8_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> <span class="hljs-type">uint16_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-type">uint32_t</span>;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br>  <span class="hljs-type">uint32_t</span> u32;<br>  <span class="hljs-type">float</span> f;<br>&#125; <span class="hljs-type">float_union_t</span>;<br><br><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">float</span> <span class="hljs-title function_">utils_get_float_at</span><span class="hljs-params">(<span class="hljs-type">void</span> *data, <span class="hljs-type">int</span> pos)</span> &#123;<br>  <span class="hljs-type">uint8_t</span> __attribute__((aligned(<span class="hljs-number">4</span>))) tmp[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>  <span class="hljs-built_in">memcpy</span>(tmp, (<span class="hljs-type">uint8_t</span> *)data, <span class="hljs-number">4</span>);<br>  <span class="hljs-type">uint32_t</span> lw = *((<span class="hljs-type">uint32_t</span> *)(((<span class="hljs-type">uint8_t</span> *)(tmp)) + pos));<br>  <span class="hljs-type">float_union_t</span> fu = &#123;.u32 = lw&#125;;<br>  <span class="hljs-keyword">return</span> fu.f;<br>&#125;<br><br><span class="hljs-comment">// true is little endian, flase is big endian</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">check_cpu</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">w</span> &#123;</span><br>    <span class="hljs-type">int</span> a;<br>    <span class="hljs-type">char</span> b;<br>  &#125; c;<br>  c.a = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> (c.b == <span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">reverse</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> data[], <span class="hljs-type">int</span> num)</span> &#123;<br>  <span class="hljs-type">int</span> i, j;<br>  <span class="hljs-type">uint16_t</span> temp;<br><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, j = num - <span class="hljs-number">1</span>; i &lt; j; i++, j--) &#123;<br>    temp = data[i];<br>    data[i] = data[j];<br>    data[j] = temp;<br>  &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> &#123;<br>  <span class="hljs-type">int</span> rc = <span class="hljs-number">2</span>;<br>  <span class="hljs-type">int</span> offset = <span class="hljs-number">1</span>;<br>  <span class="hljs-type">uint8_t</span> rsp[] = &#123;<span class="hljs-number">0x01</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x93</span>&#125;;<br>  <span class="hljs-type">uint16_t</span> dest[<span class="hljs-number">2</span>];<br><br>  bzero(dest, <span class="hljs-keyword">sizeof</span>(dest));<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; rc; i++) &#123;<br>    <span class="hljs-comment">/* shift reg hi_byte to temp OR with lo_byte */</span><br>    dest[i] = (rsp[offset + <span class="hljs-number">2</span> + (i &lt;&lt; <span class="hljs-number">1</span>)] &lt;&lt; <span class="hljs-number">8</span>) | rsp[offset + <span class="hljs-number">3</span> + (i &lt;&lt; <span class="hljs-number">1</span>)];<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (!check_cpu()) &#123;<br>    reverse(dest, <span class="hljs-number">2</span>);<br>  &#125;<br><br>  <span class="hljs-type">float</span> value = utils_get_float_at(dest, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;value = %f\n&quot;</span>, value);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>最后还加入了一个对 cpu 的大小端序判断，这样可用性会更强。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>003-入手VPS后要做的几件事</title>
    <link href="/2023/10/03/003-%E5%85%A5%E6%89%8BVPS%E5%90%8E%E8%A6%81%E5%81%9A%E7%9A%84%E5%87%A0%E4%BB%B6%E4%BA%8B/"/>
    <url>/2023/10/03/003-%E5%85%A5%E6%89%8BVPS%E5%90%8E%E8%A6%81%E5%81%9A%E7%9A%84%E5%87%A0%E4%BB%B6%E4%BA%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="入手-VPS-后要做的几件事"><a href="#入手-VPS-后要做的几件事" class="headerlink" title="入手 VPS 后要做的几件事"></a>入手 VPS 后要做的几件事</h1><p>前几天新购买了一台小鸡，在首次使用时进行了一些配置上的修改，在这里与大家分享。按照本文章的操作，可以大大降低成为肉鸡的概率。</p><p>本文系统：Ubuntu 18.04</p><p><strong>注：本文代码块前的 $ 代表在终端中的输入指令，复制时请勿输入！</strong></p><h2 id="修改-root-密码"><a href="#修改-root-密码" class="headerlink" title="修改 root 密码"></a>修改 root 密码</h2><p>如果你的VPS提供商的机子没有 root 密码，一定一定要马上修改一个密码。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">passwd</span><br>Enter new UNIX password: <br>Retype new UNIX password: <br>passwd: password updated successfully<br></code></pre></td></tr></table></figure><h2 id="创建管理员账号"><a href="#创建管理员账号" class="headerlink" title="创建管理员账号"></a>创建管理员账号</h2><p>这里的管理员是指，能够运行 sudo 命令的用户，为了安全，在正常使用中禁止使用 root 账号操作。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">adduser &lt;username&gt;</span><br>Enter new UNIX password: <br>Retype new UNIX password: <br><br>这里输入密码后可能还会提示需要输入用户的信息，回车默认即可<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">usermod -aG sudo &lt;username&gt; <span class="hljs-comment"># 为用户添加 sudo 权限</span></span><br></code></pre></td></tr></table></figure><h2 id="删除默认用户和组"><a href="#删除默认用户和组" class="headerlink" title="删除默认用户和组"></a>删除默认用户和组</h2><p>可以使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> /etc/passwd</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> /etc/group</span><br></code></pre></td></tr></table></figure><p>来分别查看用户列表和组列表</p><p>删除多余的用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">userdel <span class="hljs-built_in">sync</span> &amp;&amp; userdel shutdown &amp;&amp; userdel halt &amp;&amp; userdel uucp &amp;&amp; userdel operator &amp;&amp; userdel games &amp;&amp; userdel gopher</span><br></code></pre></td></tr></table></figure><p>删除多余组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">groupdel adm &amp;&amp; groupdel games &amp;&amp; groupdel lp &amp;&amp; groupdel dip</span><br></code></pre></td></tr></table></figure><p>删除了不必要的用户和组后，我们将用户管理的权限关闭</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">chattr +i /etc/passwd</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">chattr +i /etc/shadow</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">chattr +i /etc/group</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">chattr +i /etc/gshadow</span><br></code></pre></td></tr></table></figure><p>i属性代表这个文件不允许被修改，删除。这样我们就无法给系统新建用户。需要新建用户的时候使用 -i 还原</p><h2 id="修改-SSH-配置"><a href="#修改-SSH-配置" class="headerlink" title="修改 SSH 配置"></a>修改 SSH 配置</h2><h3 id="添加-ssh-私钥"><a href="#添加-ssh-私钥" class="headerlink" title="添加 ssh 私钥"></a>添加 ssh 私钥</h3><p>在你的 windows 终端下生成一对私钥对，个人喜好使用 GitHub 推荐的 Ed25519 算法</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>ssh-keygen -t ed25519<br></code></pre></td></tr></table></figure><p>可以自己指定文件保存的路径，一般来说默认即可。之后询问是否输入密码，这里建议还是输入一个密码。</p><p>现在我们需要的私钥上传到服务器中，我直接上传到 home 目录下了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">创建 .ssh 文件夹</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> ~/.ssh</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">chmod</span> 700 ~/.ssh</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mv</span> id_ed25519 ~/.ssh/authorized_keys</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">chmod</span> 400 ~/.ssh/authorized_keys</span><br></code></pre></td></tr></table></figure><h3 id="禁用-root-登录及密码登录"><a href="#禁用-root-登录及密码登录" class="headerlink" title="禁用 root 登录及密码登录"></a>禁用 root 登录及密码登录</h3><p>在上传了 ssh 公钥后，我们需要关闭 root 账号的登录权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo vi /etc/ssh/sshd_config</span><br></code></pre></td></tr></table></figure><p>将<code>PermitRootLogin yes</code> 改为 <code>PermitRootLogin no</code> 关闭 root 登录<br>将<code>PasswordAuthentication yes</code> 改为 <code>PasswordAuthentication no</code> 关闭密码登录</p><p>在配置文件最后新增一行</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ClientAliveInterval</span> <span class="hljs-number">60</span><br></code></pre></td></tr></table></figure><h3 id="修改-ssh-端口"><a href="#修改-ssh-端口" class="headerlink" title="修改 ssh 端口"></a>修改 ssh 端口</h3><p>同上一步，将 <code>Port 22</code> 改为任意没有被占用的端口，建议改成小众一点的</p><p>全部修改完成后，重启 ssh 服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo service sshd restart</span><br></code></pre></td></tr></table></figure><p>可以重新连接一下，看是否修改成功</p><h2 id="安装-Fail2Ban"><a href="#安装-Fail2Ban" class="headerlink" title="安装 Fail2Ban"></a>安装 Fail2Ban</h2><p><a href="https://github.com/fail2ban/fail2ban">Fail2Ban</a> 是一款入侵防御软件， 将尝试爆破 ssh 密码的 ip 封停，可以保护服务器免受暴力攻击。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt install fail2ban</span><br></code></pre></td></tr></table></figure><h2 id="安装长亭雷池-WAF"><a href="#安装长亭雷池-WAF" class="headerlink" title="安装长亭雷池 WAF"></a>安装长亭雷池 WAF</h2><p><a href="https://github.com/chaitin/safeline">雷池</a> 是一款足够简单、足够好用、足够强的免费 WAF。基于业界领先的语义引擎检测技术，作为反向代理接入，保护你的网站不受黑客攻击。</p><p>核心检测能力由智能语义分析算法驱动，专为社区而生，不让黑客越雷池半步。</p><h3 id="配置需求"><a href="#配置需求" class="headerlink" title="配置需求"></a>配置需求</h3><ul><li>操作系统：Linux</li><li>指令架构：x86_64</li><li>软件依赖：Docker 20.10.6 版本以上</li><li>软件依赖：Docker Compose 2.0.0 版本以上</li><li>最小化环境：1 核 CPU &#x2F; 1 GB 内存 &#x2F; 10 GB 磁盘</li></ul><h3 id="一键安装"><a href="#一键安装" class="headerlink" title="一键安装"></a>一键安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bash -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -fsSLk https://waf-ce.chaitin.cn/release/latest/setup.sh)</span>&quot;</span></span><br></code></pre></td></tr></table></figure><blockquote><p>更多安装方式请参考 <a href="https://waf-ce.chaitin.cn/posts/guide_install">安装雷池</a></p></blockquote><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>浏览器打开后台管理页面 <code>https://&lt;waf-ip&gt;:9443</code>。根据界面提示，使用 <strong>支持 TOTP 的认证软件</strong> 扫描二维码，然后输入动态口令登录。</p><h2 id="禁止系统响应任何从外部-内部来的-ping-请求"><a href="#禁止系统响应任何从外部-内部来的-ping-请求" class="headerlink" title="禁止系统响应任何从外部&#x2F;内部来的 ping 请求"></a>禁止系统响应任何从外部&#x2F;内部来的 ping 请求</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br></code></pre></td></tr></table></figure><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://zhuanlan.zhihu.com/p/371611071">https://zhuanlan.zhihu.com/p/371611071</a></p><p><a href="https://www.logcg.com/archives/884.html">https://www.logcg.com/archives/884.html</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>002-OpenWrt中GRE掉线问题</title>
    <link href="/2023/09/26/002-OpenWrt%E4%B8%ADGRE%E6%8E%89%E7%BA%BF%E9%97%AE%E9%A2%98/"/>
    <url>/2023/09/26/002-OpenWrt%E4%B8%ADGRE%E6%8E%89%E7%BA%BF%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>前几天使用OpenWrt测试GRE功能时发现，在4G网络和有线网之间切换会导致掉线，遂简单排查了一下问题所在。</p><h3 id="情景复现"><a href="#情景复现" class="headerlink" title="情景复现"></a>情景复现</h3><p><strong>本机</strong></p><p>系统：OpenWrt</p><p>有线网卡（wan）：eth1，IP：192.168.0.194，子网掩码：255.255.255.0，网关：192.168.0.1</p><p>有线网卡（lan）：br-lan，IP：192.168.3.1，子网掩码：255.255.255.0</p><p>无线网卡（wwan）：usb0，IP：10.221.139.224，子网掩码：255.255.255.0，网关：10.221.139.1</p><p>无线网卡使用中国移动4G卡上网</p><p><strong>GRE对端</strong></p><p>系统：OpenWrt</p><p>有线网卡（wan）：eth1，IP：192.168.0.242，子网掩码：255.255.255.0，网关：192.168.0.1</p><p>有线网卡（lan）：br-lan，IP：192.168.2.218，子网掩码：255.255.255.0</p><img src="/2023/09/26/002-OpenWrt%E4%B8%ADGRE%E6%8E%89%E7%BA%BF%E9%97%AE%E9%A2%98/network_topology_diagram.png" class="" title="网络拓扑图"><p>本机GRE配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /etc/config/network<br><br>config interface &#x27;gresbksg&#x27;<br>        option disabled &#x27;0&#x27;<br>        option peeraddr &#x27;192.168.0.242&#x27; // 对端IP<br>        option proto &#x27;gre&#x27;<br>        option mtu &#x27;1280&#x27;<br>        option peerlocalip &#x27;192.168.2.0&#x27; // 对端<br>        option peerlocalmask &#x27;255.255.255.0&#x27;<br>        option zone &#x27;wan&#x27;<br><br>config interface &#x27;gresbksg_grestatic&#x27;<br>        option ifname &#x27;@gresbksg&#x27;<br>        option disabled &#x27;0&#x27;<br>        option ipaddr &#x27;192.168.5.1&#x27; // GRE隧道IP，对端为192.168.5.2<br>        option netmask &#x27;255.255.255.0&#x27;<br>        option proto &#x27;static&#x27;<br>        option zone &#x27;wan&#x27;<br></code></pre></td></tr></table></figure><p>GRE正常建立，流量走eth1，此时的路由表：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         192.168.0.1     0.0.0.0         UG    10     0        0 eth1<br>0.0.0.0         10.221.139.1    0.0.0.0         UG    12     0        0 usb0<br>10.221.139.0    0.0.0.0         255.255.255.0   U     12     0        0 usb0<br>192.168.0.0     0.0.0.0         255.255.255.0   U     10     0        0 eth1<br>192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br>192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan<br>192.168.5.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br></code></pre></td></tr></table></figure><p>此时本机可以直接ping通对端的lan口，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# ping 192.168.2.218<br>PING 192.168.2.218 (192.168.2.218): 56 data bytes<br>64 bytes from 192.168.2.218: seq=0 ttl=64 time=1.481 ms<br>64 bytes from 192.168.2.218: seq=1 ttl=64 time=4.312 ms<br>64 bytes from 192.168.2.218: seq=2 ttl=64 time=2.344 ms<br>64 bytes from 192.168.2.218: seq=3 ttl=64 time=1.579 ms<br>64 bytes from 192.168.2.218: seq=4 ttl=64 time=3.409 ms<br>--- 192.168.2.218 ping statistics ---<br>5 packets transmitted, 5 packets received, 0% packet loss<br>round-trip min/avg/max = 1.481/2.625/4.312 ms<br></code></pre></td></tr></table></figure><p>路由追踪：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# traceroute 192.168.2.218<br>traceroute to 192.168.2.218 (192.168.2.218), 30 hops max, 38 byte packets<br> 1  192.168.2.218 (192.168.2.218)  1.173 ms  2.722 ms  2.603 ms<br><br></code></pre></td></tr></table></figure><p>拔掉wan口网线后，此时正常情况下应该无法ping通，因为GRE在内网中，路由表：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         10.77.102.1     0.0.0.0         UG    12     0        0 usb0<br>10.77.102.0     0.0.0.0         255.255.255.0   U     12     0        0 usb0<br>192.168.0.242   10.77.102.1     255.255.255.255 UGH   12     0        0 usb0<br>192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br>192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan<br>192.168.5.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br></code></pre></td></tr></table></figure><p>将网线接回去后，还是无法ping通，此时的路由表：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         192.168.0.1     0.0.0.0         UG    10     0        0 eth1<br>0.0.0.0         10.77.102.1     0.0.0.0         UG    12     0        0 usb0<br>10.77.102.0     0.0.0.0         255.255.255.0   U     12     0        0 usb0<br>192.168.0.0     0.0.0.0         255.255.255.0   U     10     0        0 eth1<br>192.168.0.242   10.77.102.1     255.255.255.255 UGH   12     0        0 usb0<br>192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br>192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan<br>192.168.5.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br></code></pre></td></tr></table></figure><p>可以发现，我们在拔掉网线后，路由表内自动添加了一条host路由</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">192.168.0.242   10.77.102.1     255.255.255.255 UGH   12     0        0 usb0<br></code></pre></td></tr></table></figure><p>但是由于我们的GRE对端是建立在内网中的，4G网络肯定是无法访问的，所有这条host路由是错误的。</p><p>当我们将网线接回后，由于已经存在了一条host路由，所有访问192.168.0.242的流量会从usb0出去，导致GRE隧道无法建立。</p><h3 id="怎么使系统正确添加host路由？"><a href="#怎么使系统正确添加host路由？" class="headerlink" title="怎么使系统正确添加host路由？"></a>怎么使系统正确添加host路由？</h3><h4 id="思路一：关闭自动添加host路由"><a href="#思路一：关闭自动添加host路由" class="headerlink" title="思路一：关闭自动添加host路由"></a>思路一：关闭自动添加host路由</h4><p>查看OpenWrt源码中的gre脚本（openwrt&#x2F;package&#x2F;network&#x2F;config&#x2F;gre&#x2F;files&#x2F;gre.sh）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-function"><span class="hljs-title">gre_setup</span></span>() &#123;<br><span class="hljs-built_in">local</span> cfg=<span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br><span class="hljs-built_in">local</span> mode=<span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span><br><span class="hljs-built_in">local</span> remoteip<br><br><span class="hljs-built_in">local</span> ipaddr peeraddr peerlocalip peerlocalmask<br>json_get_vars <span class="hljs-built_in">df</span> ipaddr peeraddr tunlink nohostroute peerlocalip peerlocalmask<br><br>[ -z <span class="hljs-string">&quot;<span class="hljs-variable">$peeraddr</span>&quot;</span> ] &amp;&amp; &#123;<br>proto_notify_error <span class="hljs-string">&quot;<span class="hljs-variable">$cfg</span>&quot;</span> <span class="hljs-string">&quot;MISSING_PEER_ADDRESS&quot;</span><br>proto_block_restart <span class="hljs-string">&quot;<span class="hljs-variable">$cfg</span>&quot;</span><br><span class="hljs-built_in">exit</span><br>&#125;<br><br>remoteip=$(resolveip -t 10 -4 <span class="hljs-string">&quot;<span class="hljs-variable">$peeraddr</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$remoteip</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>proto_notify_error <span class="hljs-string">&quot;<span class="hljs-variable">$cfg</span>&quot;</span> <span class="hljs-string">&quot;PEER_RESOLVE_FAIL&quot;</span><br><span class="hljs-built_in">exit</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> <span class="hljs-variable">$remoteip</span>; <span class="hljs-keyword">do</span><br>peeraddr=<span class="hljs-variable">$ip</span><br><span class="hljs-built_in">break</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;nohostroute&#125;</span>&quot;</span> != <span class="hljs-string">&quot;1&quot;</span> ]; <span class="hljs-keyword">then</span><br>( proto_add_host_dependency <span class="hljs-string">&quot;<span class="hljs-variable">$cfg</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$peeraddr</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$tunlink</span>&quot;</span> )<br><span class="hljs-keyword">fi</span><br><br>[ -z <span class="hljs-string">&quot;<span class="hljs-variable">$ipaddr</span>&quot;</span> ] &amp;&amp; &#123;<br><span class="hljs-built_in">local</span> wanif=<span class="hljs-string">&quot;<span class="hljs-variable">$tunlink</span>&quot;</span><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$wanif</span> ] &amp;&amp; ! network_find_wan wanif; <span class="hljs-keyword">then</span><br>proto_notify_error <span class="hljs-string">&quot;<span class="hljs-variable">$cfg</span>&quot;</span> <span class="hljs-string">&quot;NO_WAN_LINK&quot;</span><br><span class="hljs-built_in">exit</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> ! network_get_ipaddr ipaddr <span class="hljs-string">&quot;<span class="hljs-variable">$wanif</span>&quot;</span>; <span class="hljs-keyword">then</span><br>proto_notify_error <span class="hljs-string">&quot;<span class="hljs-variable">$cfg</span>&quot;</span> <span class="hljs-string">&quot;NO_WAN_LINK&quot;</span><br><span class="hljs-built_in">exit</span><br><span class="hljs-keyword">fi</span><br>&#125;<br><br>[ -z <span class="hljs-string">&quot;<span class="hljs-variable">$df</span>&quot;</span> ] &amp;&amp; <span class="hljs-built_in">df</span>=<span class="hljs-string">&quot;1&quot;</span><br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$mode</span>&quot;</span> <span class="hljs-keyword">in</span><br>gretapip)<br>gre_generic_setup <span class="hljs-variable">$cfg</span> <span class="hljs-variable">$mode</span> <span class="hljs-variable">$ipaddr</span> <span class="hljs-variable">$peeraddr</span> <span class="hljs-string">&quot;gre4t-<span class="hljs-variable">$cfg</span>&quot;</span><br>route add -net <span class="hljs-string">&quot;<span class="hljs-variable">$peerlocalip</span>&quot;</span> netmask <span class="hljs-string">&quot;<span class="hljs-variable">$peerlocalmask</span>&quot;</span> dev <span class="hljs-string">&quot;gre4t-<span class="hljs-variable">$cfg</span>&quot;</span><br>;;<br>*)<br>gre_generic_setup <span class="hljs-variable">$cfg</span> <span class="hljs-variable">$mode</span> <span class="hljs-variable">$ipaddr</span> <span class="hljs-variable">$peeraddr</span> <span class="hljs-string">&quot;gre4-<span class="hljs-variable">$cfg</span>&quot;</span><br>route add -net <span class="hljs-string">&quot;<span class="hljs-variable">$peerlocalip</span>&quot;</span> netmask <span class="hljs-string">&quot;<span class="hljs-variable">$peerlocalmask</span>&quot;</span> dev <span class="hljs-string">&quot;gre4-<span class="hljs-variable">$cfg</span>&quot;</span><br>;;<br><span class="hljs-keyword">esac</span><br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，只有在nohostroute为非1时，才会添加host路由</p><blockquote><p>以下是ChatGPT的回答：</p></blockquote><p><code>proto_add_host_dependency</code>是OpenWrt中的一个函数，它用于向当前接口的依赖列表中添加一个host依赖项。</p><p>在OpenWrt中，每个接口都有一个依赖列表，用于记录这个接口所依赖的其他接口或主机。当这个接口启动时，系统会检查它的依赖列表，如果依赖项中有任何一个接口或主机不可达，这个接口就无法启动。这种机制可以保证网络的连通性和稳定性。</p><p><code>proto_add_host_dependency</code>函数用于向当前接口的依赖列表中添加一个host依赖项。它接受三个参数：当前接口的配置名称、依赖主机的IP地址、依赖主机所在的网络接口名称。例如，以下命令将当前接口<code>eth0</code>添加一个host依赖项，依赖主机的IP地址是<code>192.168.1.1</code>，所在的网络接口名称是<code>eth1</code>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proto_add_host_dependency</span> <span class="hljs-string">&quot;eth0&quot;</span> <span class="hljs-string">&quot;192.168.1.1&quot;</span> <span class="hljs-string">&quot;eth1&quot;</span><br></code></pre></td></tr></table></figure><p>在GRE隧道的配置中，<code>proto_add_host_dependency</code>函数通常用于将对端IP地址添加到当前隧道的依赖列表中。这样，当对端不可达时，当前隧道就无法启动，从而避免了无效的隧道连接。</p><p>在你的问题中，<code>proto_add_host_dependency</code>函数用于向当前GRE隧道的依赖列表中添加对端IP地址的host依赖项。如果<code>nohostroute</code>字段没有设置为<code>1</code>，系统会自动添加这个host路由，使得对端IP地址可达。如果<code>nohostroute</code>字段设置为<code>1</code>，则需要手动使用<code>proto_add_host_dependency</code>函数将对端IP地址添加到依赖列表中，否则GRE隧道无法启动。</p><p>OpenWrt官方是这样<a href="https://openwrt.org/docs/guide-user/network/tunneling_interface_protocols">解释</a>这个参数的：</p><table><thead><tr><th>Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>nohostroute</td><td>boolean</td><td>no</td><td>0</td><td>Do not add routes to ensure the tunnel endpoints are routed via non-tunnel device</td></tr></tbody></table><p>于是我尝试了更改GRE的配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">config interface &#x27;gresbksg&#x27;<br>        option disabled &#x27;0&#x27;<br>        option peeraddr &#x27;192.168.0.242&#x27;<br>        option proto &#x27;gre&#x27;<br>        option mtu &#x27;1280&#x27;<br>        option peerlocalip &#x27;192.168.2.0&#x27;<br>        option peerlocalmask &#x27;255.255.255.0&#x27;<br>        option zone &#x27;wan&#x27;<br>        option nohostroute &#x27;1&#x27;<br><br>config interface &#x27;gresbksg_grestatic&#x27;<br>        option ifname &#x27;@gresbksg&#x27;<br>        option disabled &#x27;0&#x27;<br>        option ipaddr &#x27;192.168.5.1&#x27;<br>        option netmask &#x27;255.255.255.0&#x27;<br>        option proto &#x27;static&#x27;<br>        option zone &#x27;wan&#x27;<br></code></pre></td></tr></table></figure><p>修改完成后重启network，发现是可以正常使用的。此时的路由表：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         192.168.0.1     0.0.0.0         UG    10     0        0 eth1<br>0.0.0.0         10.162.134.1    0.0.0.0         UG    12     0        0 usb0<br>10.162.134.0    0.0.0.0         255.255.255.0   U     12     0        0 usb0<br>192.168.0.0     0.0.0.0         255.255.255.0   U     10     0        0 eth1<br>192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br>192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan<br>192.168.5.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br></code></pre></td></tr></table></figure><p>将网线拔掉后，路由表已经不会自动添加host路由了：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         10.162.134.1    0.0.0.0         UG    12     0        0 usb0<br>10.162.134.0    0.0.0.0         255.255.255.0   U     12     0        0 usb0<br>192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br>192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan<br>192.168.5.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br></code></pre></td></tr></table></figure><p>然后再接回网线，查看路由表：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         192.168.0.1     0.0.0.0         UG    10     0        0 eth1<br>0.0.0.0         10.162.134.1    0.0.0.0         UG    12     0        0 usb0<br>10.162.134.0    0.0.0.0         255.255.255.0   U     12     0        0 usb0<br>192.168.0.0     0.0.0.0         255.255.255.0   U     10     0        0 eth1<br>192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br>192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan<br>192.168.5.0     0.0.0.0         255.255.255.0   U     0      0        0 gre4-gresbksg<br></code></pre></td></tr></table></figure><p>可以发现因为没有错误的host路由，我们的GRE隧道又能正常建立连接了。尝试ping一下对端的LAN口：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@pg-2049671F7524:~# ping 192.168.2.218<br>PING 192.168.2.218 (192.168.2.218): 56 data bytes<br>64 bytes from 192.168.2.218: seq=0 ttl=64 time=1.810 ms<br>64 bytes from 192.168.2.218: seq=1 ttl=64 time=3.701 ms<br>64 bytes from 192.168.2.218: seq=2 ttl=64 time=6.526 ms<br>64 bytes from 192.168.2.218: seq=3 ttl=64 time=4.254 ms<br>--- 192.168.2.218 ping statistics ---<br>4 packets transmitted, 4 packets received, 0% packet loss<br>round-trip min/avg/max = 1.810/4.072/6.526 ms<br></code></pre></td></tr></table></figure><p><strong>疑惑：为什么用有线时，不会添加host路由？</strong></p><h4 id="思路二：将GRE隧道绑定到某个接口上-未成功"><a href="#思路二：将GRE隧道绑定到某个接口上-未成功" class="headerlink" title="思路二：将GRE隧道绑定到某个接口上(未成功)"></a>思路二：将GRE隧道绑定到某个接口上(未成功)</h4><p><del>可以使用参数<code>tunlink</code></del></p><table><thead><tr><th>Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>tunlink</td><td>string</td><td>no</td><td>(none)</td><td>Bind the tunnel to the specified interface, OpenWrt 21.02+</td></tr></tbody></table><p><del>修改network中gre的配置，将GRE隧道绑定到本地网络接口eth1上：</del></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>001-C语言中将char=1会发生什么？</title>
    <link href="/2023/09/10/001-C%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%B0%86char-1%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88%EF%BC%9F/"/>
    <url>/2023/09/10/001-C%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%B0%86char-1%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
